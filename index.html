<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá´üá∑ French Fun Helper üéâ</title>
    
    <!-- Apple Touch Icons (iOS) -->
    <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icon.png">
    
    <!-- For older iOS -->
    <link rel="apple-touch-icon-precomposed" href="icon.png">
    
    <!-- Favicon for browsers -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Theme colors -->
    <meta name="theme-color" content="#FF6B8B">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="French Fun Helper">
    
    <!-- For Microsoft -->
    <meta name="msapplication-TileColor" content="#FF6B8B">
    <meta name="msapplication-TileImage" content="icon.png">
    
    <!-- Fonts for kids -->
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Nunito', 'Comic Neue', cursive, sans-serif; 
            padding: 15px; 
            background: linear-gradient(135deg, #FFD6E7 0%, #C1F0FF 100%); 
            min-height: 100vh; 
            -webkit-tap-highlight-color: transparent;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(255, 107, 139, 0.2); 
            overflow: hidden;
            border: 8px solid #FFD166;
        }
        .header { 
            background: linear-gradient(135deg, #FF6B8B 0%, #FF8E53 100%); 
            color: white; 
            padding: 25px 18px; 
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: "üéâüéà‚ú®";
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            opacity: 0.7;
        }
        .header::after {
            content: "üá´üá∑üá¨üáß";
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 24px;
            opacity: 0.7;
        }
        h1 { 
            font-size: 32px; 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 15px; 
            flex-wrap: wrap;
            font-family: 'Comic Neue', cursive;
            text-shadow: 2px 2px 0 #FF8E53;
        }
        .header p { 
            font-size: 18px; 
            opacity: 0.95; 
            margin-top: 8px;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.2);
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }
        .content-area { padding: 25px; }
        h2 { 
            font-size: 24px; 
            color: #FF6B8B; 
            margin-bottom: 20px; 
            font-weight: 900;
            font-family: 'Comic Neue', cursive;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        h3 { 
            font-size: 20px; 
            color: #06D6A0; 
            margin-bottom: 16px; 
            font-weight: 900;
            font-family: 'Comic Neue', cursive;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .phrase-sets { 
            margin-bottom: 30px; 
            padding: 22px; 
            background: linear-gradient(135deg, #F0F9FF 0%, #E6F7FF 100%); 
            border-radius: 20px; 
            border: 4px dashed #118AB2;
            box-shadow: 0 5px 15px rgba(17, 138, 178, 0.1);
        }
        .preset-buttons { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
        }
        @media (min-width: 600px) { 
            .preset-buttons { 
                grid-template-columns: repeat(3, 1fr); 
            } 
        }
        .preset-btn { 
            padding: 18px 12px; 
            background: white; 
            border: 3px solid #FFD166; 
            border-radius: 15px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 700; 
            color: #073B4C; 
            transition: all 0.3s; 
            text-align: center; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            min-height: 55px;
            box-shadow: 0 4px 0 #FFB347;
        }
        .preset-btn:active { 
            transform: translateY(4px);
            box-shadow: 0 0 0 #FFB347;
        }
        .preset-btn:hover {
            background: #FFF9C4;
            transform: translateY(-2px);
        }
        .preset-btn.active { 
            background: linear-gradient(135deg, #FFD166 0%, #FFB347 100%); 
            color: white; 
            border-color: #FFB347;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #FF8E53;
        }
        textarea { 
            width: 100%; 
            height: 160px; 
            padding: 20px; 
            font-size: 18px; 
            border: 4px solid #FFD166; 
            border-radius: 20px; 
            margin: 22px 0; 
            font-family: inherit; 
            resize: vertical; 
            background: #FFF9E6;
            font-weight: 600;
            color: #073B4C;
        }
        textarea:focus {
            outline: none;
            border-color: #FF6B8B;
            box-shadow: 0 0 0 3px rgba(255, 107, 139, 0.3);
        }
        .button-row { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 25px; 
            flex-wrap: wrap; 
        }
        .button-row button { 
            flex: 1; 
            min-width: calc(50% - 7.5px); 
            padding: 20px; 
            color: white; 
            border: none; 
            border-radius: 15px; 
            font-size: 18px; 
            font-weight: 900; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 12px; 
            transition: all 0.3s;
            font-family: 'Comic Neue', cursive;
            box-shadow: 0 6px 0 rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        .button-row button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .button-row button:hover::before {
            left: 100%;
        }
        .button-row button:active { 
            transform: translateY(6px);
            box-shadow: 0 0 0 rgba(0,0,0,0.2);
        }
        .save-btn { 
            background: linear-gradient(135deg, #06D6A0 0%, #0CB48A 100%);
            box-shadow: 0 6px 0 #0A9E7A;
        }
        .clear-btn { 
            background: linear-gradient(135deg, #EF476F 0%, #D43D63 100%);
            box-shadow: 0 6px 0 #B83455;
        }
        .bulk-save-btn { 
            background: linear-gradient(135deg, #118AB2 0%, #0F7AA3 100%);
            box-shadow: 0 6px 0 #0D698C;
        }
        .install-btn { 
            background: linear-gradient(135deg, #9D4EDD 0%, #8A42C6 100%);
            box-shadow: 0 6px 0 #7A38B0;
        }
        .share-btn { 
            background: linear-gradient(135deg, #FF9E6D 0%, #FF8E53 100%);
            box-shadow: 0 6px 0 #FF7A3D;
        }
        .button-row button:disabled { 
            opacity: 0.5; 
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2) !important;
        }
        .section-divider { 
            border-top: 4px dotted #FFD166; 
            margin: 32px 0; 
            padding-top: 25px; 
            position: relative;
        }
        .section-divider::before {
            content: "‚ú®üåü‚≠ê";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 0 15px;
            font-size: 20px;
        }
        .phrases-container { margin-top: 30px; }
        .status-bar { 
            background: linear-gradient(135deg, #CBF3F0 0%, #A6E9E5 100%); 
            padding: 16px; 
            border-radius: 15px; 
            margin-bottom: 25px; 
            text-align: center; 
            font-size: 16px; 
            color: #118AB2; 
            font-weight: 700;
            border: 3px solid #06D6A0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .status-bar.offline { 
            background: linear-gradient(135deg, #FFE5B4 0%, #FFD899 100%); 
            color: #FF8E53;
            border-color: #FFB347;
        }
        .phrase-card { 
            background: linear-gradient(135deg, #FFF 0%, #F8F9FF 100%); 
            border: 4px solid #CBF3F0; 
            border-radius: 20px; 
            padding: 25px; 
            margin-bottom: 22px; 
            transition: all 0.3s; 
            position: relative;
            box-shadow: 0 5px 15px rgba(203, 243, 240, 0.3);
        }
        .phrase-card.speaking { 
            background: linear-gradient(135deg, #E8F5E9 0%, #D4EDDA 100%); 
            border-color: #06D6A0; 
            transform: translateY(-3px) scale(1.02); 
            box-shadow: 0 10px 25px rgba(6, 214, 160, 0.3);
            animation: wiggle 0.5s ease-in-out;
        }
        @keyframes wiggle {
            0%, 100% { transform: translateY(-3px) scale(1.02) rotate(0deg); }
            25% { transform: translateY(-3px) scale(1.02) rotate(1deg); }
            75% { transform: translateY(-3px) scale(1.02) rotate(-1deg); }
        }
        .french-text { 
            font-size: 26px; 
            color: #073B4C; 
            text-align: center; 
            margin-bottom: 15px; 
            font-weight: 900; 
            line-height: 1.4;
            font-family: 'Comic Neue', cursive;
            text-shadow: 1px 1px 0 #FFD166;
        }
        .phrase-card.speaking .french-text { 
            color: #06D6A0; 
            animation: colorPulse 1s infinite;
        }
        @keyframes colorPulse {
            0%, 100% { color: #06D6A0; }
            50% { color: #0CB48A; }
        }
        .english-text { 
            font-size: 18px; 
            color: #6C757D; 
            text-align: center; 
            font-style: italic; 
            min-height: 26px; 
            transition: all 0.3s; 
            line-height: 1.5;
            font-weight: 600;
        }
        .phrase-card.has-translation .english-text { 
            color: #118AB2; 
            font-weight: 700;
            text-shadow: 1px 1px 0 rgba(203, 243, 240, 0.5);
        }
        .buttons-row { 
            display: flex; 
            gap: 15px; 
            justify-content: center; 
            margin-top: 25px; 
        }
        .speak-btn, .translate-btn { 
            padding: 18px 24px; 
            border-radius: 15px; 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-size: 18px; 
            font-weight: 900; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            flex: 1; 
            justify-content: center; 
            transition: all 0.3s; 
            min-height: 60px;
            font-family: 'Comic Neue', cursive;
            box-shadow: 0 6px 0 rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        .speak-btn::before, .translate-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        .speak-btn:hover::before, .translate-btn:hover::before {
            left: 100%;
        }
        .speak-btn:active, .translate-btn:active { 
            transform: translateY(6px);
            box-shadow: 0 0 0 rgba(0,0,0,0.2);
        }
        .speak-btn { 
            background: linear-gradient(135deg, #06D6A0 0%, #0CB48A 100%);
            box-shadow: 0 6px 0 #0A9E7A;
        }
        .speak-btn:hover {
            background: linear-gradient(135deg, #0CB48A 0%, #06D6A0 100%);
        }
        .translate-btn { 
            background: linear-gradient(135deg, #FF9E6D 0%, #FF8E53 100%);
            box-shadow: 0 6px 0 #FF7A3D;
        }
        .translate-btn:hover {
            background: linear-gradient(135deg, #FF8E53 0%, #FF9E6D 100%);
        }
        .translate-btn.translating { 
            background: linear-gradient(135deg, #FFB74D 0%, #FF9800 100%);
            animation: pulse 1s infinite;
        }
        .speak-btn:disabled, .translate-btn:disabled { 
            opacity: 0.6; 
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2) !important;
        }
        .speaking-indicator { 
            display: none; 
            justify-content: center; 
            align-items: center; 
            margin-top: 20px; 
            color: #06D6A0; 
            font-weight: 700; 
            gap: 12px; 
            font-size: 16px;
            font-family: 'Comic Neue', cursive;
        }
        .phrase-card.speaking .speaking-indicator { 
            display: flex; 
            animation: bounce 0.5s infinite alternate;
        }
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }
        .pulse-dot { 
            width: 12px; 
            height: 12px; 
            background: #06D6A0; 
            border-radius: 50%; 
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 10px #06D6A0;
        }
        @keyframes pulse { 
            0% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(6, 214, 160, 0.7); } 
            70% { transform: scale(1.5); opacity: 0.7; box-shadow: 0 0 0 10px rgba(6, 214, 160, 0); } 
            100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(6, 214, 160, 0); } 
        }
        .empty-state { 
            text-align: center; 
            color: #6C757D; 
            padding: 50px 25px; 
            font-size: 18px; 
            line-height: 1.6;
            font-weight: 600;
        }
        .empty-state p {
            margin: 10px 0;
        }
        .confidence-badge { 
            position: absolute; 
            top: 15px; 
            right: 15px; 
            background: linear-gradient(135deg, #E8F5E9 0%, #D4EDDA 100%); 
            color: #06D6A0; 
            padding: 8px 14px; 
            border-radius: 20px; 
            font-size: 14px; 
            font-weight: 900;
            font-family: 'Comic Neue', cursive;
            border: 2px solid #06D6A0;
            box-shadow: 0 3px 0 #0A9E7A;
        }
        .progress-bar { 
            width: 100%; 
            height: 12px; 
            background: #FFD166; 
            border-radius: 10px; 
            margin: 15px 0; 
            overflow: hidden; 
            display: none;
            border: 3px solid #FFB347;
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(135deg, #118AB2 0%, #0F7AA3 100%); 
            width: 0%; 
            transition: width 0.3s;
            border-radius: 8px;
        }
        .progress-text { 
            text-align: center; 
            font-size: 18px; 
            color: #118AB2; 
            margin-bottom: 15px; 
            display: none;
            font-weight: 700;
            font-family: 'Comic Neue', cursive;
        }
        
        /* Share modal styles */
        .share-modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(255, 214, 102, 0.9); 
            z-index: 1000; 
            align-items: center; 
            justify-content: center; 
            backdrop-filter: blur(5px);
        }
        .share-content { 
            background: white; 
            padding: 30px; 
            border-radius: 25px; 
            max-width: 500px; 
            width: 90%; 
            text-align: center;
            border: 8px solid #FF6B8B;
            box-shadow: 0 15px 35px rgba(255, 107, 139, 0.3);
        }
        .share-options { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 20px; 
            margin: 25px 0; 
        }
        .share-option { 
            padding: 22px; 
            border: 4px solid #FFD166; 
            border-radius: 20px; 
            cursor: pointer; 
            transition: all 0.3s; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px;
            background: #FFF9E6;
        }
        .share-option:hover { 
            transform: translateY(-5px) scale(1.05); 
            box-shadow: 0 10px 20px rgba(255, 214, 102, 0.3);
            background: #FFF9C4;
        }
        .share-option i { font-size: 40px; }
        .share-option span { 
            font-size: 16px; 
            font-weight: 900; 
            color: #073B4C;
            font-family: 'Comic Neue', cursive;
        }
        .share-url { 
            background: #F0F9FF; 
            padding: 18px; 
            border-radius: 15px; 
            margin: 25px 0; 
            font-size: 16px; 
            word-break: break-all;
            border: 3px solid #118AB2;
            font-weight: 600;
        }
        .close-share { 
            margin-top: 25px; 
            padding: 15px 35px; 
            background: linear-gradient(135deg, #FF6B8B 0%, #FF8E53 100%); 
            color: white; 
            border: none; 
            border-radius: 15px; 
            cursor: pointer; 
            font-weight: 900;
            font-size: 18px;
            font-family: 'Comic Neue', cursive;
            box-shadow: 0 6px 0 #FF7A3D;
        }
        .close-share:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #FF7A3D;
        }
        .qr-code { 
            margin: 25px auto; 
            max-width: 220px; 
        }
        
        /* Speech prompt styles */
        .speech-prompt {
            background: linear-gradient(135deg, #FFF9C4 0%, #FFE5B4 100%) !important;
            color: #FF8E53 !important;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            transition: all 0.3s;
            border: 4px solid #FFD166 !important;
            font-weight: 900;
            font-size: 18px;
            font-family: 'Comic Neue', cursive;
            box-shadow: 0 5px 0 #FFB347;
            padding: 18px !important;
        }
        .speech-prompt:hover {
            background: linear-gradient(135deg, #FFE5B4 0%, #FFF9C4 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #FFB347;
        }
        .speech-prompt:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #FFB347;
        }
        
        /* Fun corner decorations */
        .fun-corner {
            position: absolute;
            font-size: 24px;
            z-index: 1;
        }
        .corner-1 { top: 10px; left: 10px; }
        .corner-2 { top: 10px; right: 10px; }
        .corner-3 { bottom: 10px; left: 10px; }
        .corner-4 { bottom: 10px; right: 10px; }
        
        @media (max-width: 480px) { 
            .buttons-row { flex-direction: column; } 
            .french-text { font-size: 22px; }
            .share-options { grid-template-columns: 1fr; }
            h1 { font-size: 24px; }
            .header p { font-size: 16px; }
        }
    </style>
</head>
<body>
    <!-- Fun corner decorations -->
    <div class="fun-corner corner-1">üé®</div>
    <div class="fun-corner corner-2">üìö</div>
    <div class="fun-corner corner-3">üéà</div>
    <div class="fun-corner corner-4">‚ú®</div>
    
    <div class="container">
        <div class="header">
            <h1><span>üá´üá∑üåà</span>French Fun Helper<span>üåàüá¨üáß</span></h1>
            <p>üé§ Tap GREEN for French ‚Ä¢ üéØ Tap ORANGE for English</p>
        </div>
        <div class="content-area">
            <div id="statusBar" class="status-bar">
                <span id="statusIcon">üåê</span>
                <span id="statusText">Ready to learn!</span>
            </div>
            
            <!-- Top action buttons -->
            <div style="display: flex; gap: 12px; margin-bottom: 25px; flex-wrap: wrap;">
                <button id="installButton" class="install-btn" style="display: none; padding: 16px 22px; border-radius: 15px; color: white; border: none; cursor: pointer; font-size: 18px; font-weight: 900; display: flex; align-items: center; justify-content: center; gap: 10px; flex: 1; min-width: 160px;">
                    <span>üì±</span> Install App
                </button>
                
                <button id="shareButton" class="share-btn" onclick="openShareModal()" style="padding: 16px 22px; border-radius: 15px; color: white; border: none; cursor: pointer; font-size: 18px; font-weight: 900; display: flex; align-items: center; justify-content: center; gap: 10px; flex: 1; min-width: 160px;">
                    <span>üéÅ</span> Share with Friends
                </button>
            </div>
            
            <!-- Progress indicator for bulk translation -->
            <div id="progressText" class="progress-text"></div>
            <div id="progressBar" class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            
            <div class="phrase-sets">
                <h3>üìö‚ú® Fun Practice Sets:</h3>
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="loadPreset(event, 'greetings')">üëãüé≠ Greetings</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'classroom')">üè´‚úèÔ∏è Classroom</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'numbers')">üî¢üéØ Numbers</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'colors')">üé®üåà Colors</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'days')">üìÖüåû Days</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'months')">üóìÔ∏èüå∏ Months</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'alphabet')">üî§üéµ Alphabet</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'family')">üë®‚Äçüë©‚Äçüëß‚Äçüë¶‚ù§Ô∏è Family</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'food')">üçéüçï Food</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'animals')">üê∂ü¶Å Animals</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'weather')">‚òÄÔ∏è‚õàÔ∏è Weather</button>
                    <button class="preset-btn" onclick="loadPreset(event, 'feelings')">üòäüé≠ Feelings</button>
                </div>
            </div>
            <div class="section-divider">
                <h2>üìùüéí This Week's Assignment:</h2>
                <textarea id="phrasesInput" placeholder="‚úèÔ∏è Enter phrases from your teacher here (one per line)...

Example:
Bonjour, comment √ßa va ?
Je m'appelle Marie.
J'ai six ans.

üåü Tip: Ask your teacher for this week's words!"></textarea>
                <div class="button-row">
                    <button id="saveBtn" class="save-btn" onclick="savePhrases()"><span>üíæ</span>Save My Work</button>
                    <button class="clear-btn" onclick="clearPhrases()"><span>üßπ</span>Clear All</button>
                    <button class="bulk-save-btn" onclick="translateAllPhrases()" id="translateAllBtn">
                        <span>üåê‚ú®</span>Translate Everything!
                    </button>
                </div>
            </div>
            <div class="phrases-container">
                <h2>üéÆ Practice Time:</h2>
                <div id="phrasesList"></div>
            </div>
        </div>
    </div>
    
    <!-- Share Modal -->
    <div id="shareModal" class="share-modal">
        <div class="share-content">
            <h2 style="color: #FF6B8B; margin-bottom: 20px; font-family: 'Comic Neue', cursive;">üéÅ Share French Fun Helper!</h2>
            <p style="color: #666; margin-bottom: 25px; font-size: 18px; font-weight: 600;">Share this fun app with friends and classmates! üéâ</p>
            
            <div class="share-options">
                <div class="share-option" onclick="shareViaURL()">
                    <span style="font-size: 36px;">üîó</span>
                    <span>Copy Link</span>
                </div>
                
                <div class="share-option" onclick="shareViaQR()">
                    <span style="font-size: 36px;">üì±</span>
                    <span>QR Code</span>
                </div>
                
                <div class="share-option" onclick="shareViaWhatsApp()">
                    <span style="font-size: 36px;">üí¨</span>
                    <span>WhatsApp</span>
                </div>
                
                <div class="share-option" onclick="shareViaEmail()">
                    <span style="font-size: 36px;">üìß</span>
                    <span>Email</span>
                </div>
            </div>
            
            <div id="shareUrlDisplay" class="share-url" style="display: none;">
                <div style="font-weight: 900; margin-bottom: 10px; color: #118AB2; font-family: 'Comic Neue', cursive;">Copy this fun link:</div>
                <div id="currentUrl"></div>
                <button onclick="copyURL()" style="margin-top: 15px; padding: 12px 20px; background: linear-gradient(135deg, #06D6A0 0%, #0CB48A 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 900; font-size: 16px; font-family: 'Comic Neue', cursive;">
                    üìã Copy to Clipboard
                </button>
            </div>
            
            <div id="qrCodeDisplay" class="qr-code" style="display: none;"></div>
            
            <div style="margin-top: 25px; font-size: 16px; color: #666; text-align: left; background: #F0F9FF; padding: 20px; border-radius: 15px; border: 3px solid #CBF3F0;">
                <p style="font-weight: 900; color: #118AB2; margin-bottom: 10px; font-family: 'Comic Neue', cursive;">üéØ Sharing Tips for Kids:</p>
                <p>‚Ä¢ üìö Share with classmates for group practice</p>
                <p>‚Ä¢ üë®‚Äçüè´ Ask your teacher to show it in class</p>
                <p>‚Ä¢ üíª Bookmark on school computers</p>
                <p>‚Ä¢ üè† Show your family at home</p>
            </div>
            
            <button class="close-share" onclick="closeShareModal()">üé™ Back to Fun!</button>
        </div>
    </div>
    
    <script>
// DOM Elements
const inp = document.getElementById('phrasesInput'),
      lst = document.getElementById('phrasesList'),
      sb = document.getElementById('statusBar'),
      statusIcon = document.getElementById('statusIcon'),
      statusText = document.getElementById('statusText'),
      installButton = document.getElementById('installButton'),
      translateAllBtn = document.getElementById('translateAllBtn'),
      progressText = document.getElementById('progressText'),
      progressBar = document.getElementById('progressBar'),
      progressFill = document.getElementById('progressFill'),
      shareModal = document.getElementById('shareModal'),
      shareUrlDisplay = document.getElementById('shareUrlDisplay'),
      qrCodeDisplay = document.getElementById('qrCodeDisplay'),
      currentUrlElement = document.getElementById('currentUrl');

// Data
const sets = {
    greetings: ["Bonjour", "Bonjour, comment √ßa va ?", "√áa va bien, merci", "Et toi ?", "Merci beaucoup", "De rien", "S'il te pla√Æt", "Excusez-moi", "Au revoir", "√Ä bient√¥t", "√Ä demain", "Bonne journ√©e"],
    classroom: ["Je vais √† l'√©cole", "J'aime l'√©cole", "Mon professeur", "Mon ami", "Mon amie", "La r√©cr√©ation", "La cantine", "La salle de classe", "O√π sont les toilettes ?", "La biblioth√®que", "Un crayon", "Un livre", "Un cahier"],
    numbers: ["Un", "Deux", "Trois", "Quatre", "Cinq", "Six", "Sept", "Huit", "Neuf", "Dix", "Onze", "Douze", "Treize", "Quatorze", "Quinze", "Seize", "Dix-sept", "Dix-huit", "Dix-neuf", "Vingt"],
    colors: ["Rouge", "Bleu", "Vert", "Jaune", "Noir", "Blanc", "Rose", "Violet", "Orange", "Marron", "Gris"],
    days: ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche", "Aujourd'hui", "Demain", "Hier"],
    months: ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"],
    alphabet: ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
    family: ["Maman", "Papa", "Mon fr√®re", "Ma s≈ìur", "Grand-m√®re", "Grand-p√®re", "Ma famille", "J'aime ma famille"],
    food: ["Une pomme", "Une banane", "Du pain", "Du fromage", "Du lait", "De l'eau", "Un croissant", "Une pizza", "Des frites", "Un g√¢teau", "Une glace"],
    animals: ["Un chat", "Un chien", "Un oiseau", "Un poisson", "Un cheval", "Une vache", "Un mouton", "Un lapin", "Un lion"],
    weather: ["Il fait beau", "Il pleut", "Il neige", "Il fait chaud", "Il fait froid", "Il y a du vent", "Il y a du soleil"],
    feelings: ["Je suis content", "Je suis contente", "Je suis triste", "Je suis fatigu√©", "Je suis fatigu√©e", "Je suis malade", "J'ai faim", "J'ai soif"]
};

const dict = {
    "bonjour": "Hello",
    "bonjour, comment √ßa va ?": "Hello, how are you?",
    "bonjour, comment ca va ?": "Hello, how are you?",
    "√ßa va bien, merci": "I'm fine, thank you",
    "ca va bien, merci": "I'm fine, thank you",
    "et toi ?": "And you?",
    "et toi": "And you",
    "merci beaucoup": "Thank you very much",
    "merci": "Thank you",
    "de rien": "You're welcome",
    "s'il te pla√Æt": "Please",
    "s'il te plait": "Please",
    "excusez-moi": "Excuse me",
    "au revoir": "Goodbye",
    "√† bient√¥t": "See you soon",
    "a bientot": "See you soon",
    "√† demain": "See you tomorrow",
    "a demain": "See you tomorrow",
    "bonne journ√©e": "Have a good day",
    "bonne journee": "Have a good day",
    "je vais √† l'√©cole": "I go to school",
    "je vais a l'ecole": "I go to school",
    "j'aime l'√©cole": "I like school",
    "j'aime l'ecole": "I like school",
    "mon professeur": "My teacher",
    "mon ami": "My friend (boy)",
    "mon amie": "My friend (girl)",
    "la r√©cr√©ation": "Recess",
    "la recreation": "Recess",
    "la cantine": "Cafeteria",
    "la salle de classe": "Classroom",
    "o√π sont les toilettes ?": "Where is the bathroom?",
    "ou sont les toilettes ?": "Where is the bathroom?",
    "la biblioth√®que": "Library",
    "la bibliotheque": "Library",
    "un crayon": "A pencil",
    "un livre": "A book",
    "un cahier": "A notebook",
    "un": "one", "deux": "two", "trois": "three", "quatre": "four", "cinq": "five",
    "six": "six", "sept": "seven", "huit": "eight", "neuf": "nine", "dix": "ten",
    "onze": "eleven", "douze": "twelve", "treize": "thirteen", "quatorze": "fourteen",
    "quinze": "fifteen", "seize": "sixteen", "dix-sept": "seventeen", "dix-huit": "eighteen",
    "dix-neuf": "nineteen", "vingt": "twenty",
    "rouge": "red", "bleu": "blue", "vert": "green", "jaune": "yellow", "noir": "black",
    "blanc": "white", "rose": "pink", "violet": "purple", "orange": "orange", "marron": "brown",
    "gris": "gray",
    "lundi": "Monday", "mardi": "Tuesday", "mercredi": "Wednesday", "jeudi": "Thursday",
    "vendredi": "Friday", "samedi": "Saturday", "dimanche": "Sunday",
    "aujourd'hui": "today", "aujourd hui": "today", "demain": "tomorrow", "hier": "yesterday",
    "janvier": "January", "f√©vrier": "February", "fevrier": "February", "mars": "March",
    "avril": "April", "mai": "May", "juin": "June", "juillet": "July",
    "ao√ªt": "August", "aout": "August", "septembre": "September", "octobre": "October",
    "novembre": "November", "d√©cembre": "December", "decembre": "December",
    "a": "A", "b": "B", "c": "C", "d": "D", "e": "E", "f": "F", "g": "G", "h": "H",
    "i": "I", "j": "J", "k": "K", "l": "L", "m": "M", "n": "N", "o": "O", "p": "P",
    "q": "Q", "r": "R", "s": "S", "t": "T", "u": "U", "v": "V", "w": "W", "x": "X",
    "y": "Y", "z": "Z",
    "maman": "mom", "papa": "dad", "mon fr√®re": "my brother", "mon frere": "my brother",
    "ma s≈ìur": "my sister", "ma soeur": "my sister", "grand-m√®re": "grandmother",
    "grand-mere": "grandmother", "grand-p√®re": "grandfather", "grand-pere": "grandfather",
    "ma famille": "my family", "j'aime ma famille": "I love my family",
    "une pomme": "an apple", "une banane": "a banana", "du pain": "bread",
    "du fromage": "cheese", "du lait": "milk", "de l'eau": "water",
    "un croissant": "a croissant", "une pizza": "a pizza", "des frites": "fries",
    "un g√¢teau": "a cake", "un gateau": "a cake", "une glace": "ice cream",
    "un chat": "a cat", "un chien": "a dog", "un oiseau": "a bird",
    "un poisson": "a fish", "un cheval": "a horse", "une vache": "a cow",
    "un mouton": "a sheep", "un lapin": "a rabbit", "un lion": "a lion",
    "il fait beau": "The weather is nice", "il pleut": "It's raining",
    "il neige": "It's snowing", "il fait chaud": "It's hot",
    "il fait froid": "It's cold", "il y a du vent": "It's windy",
    "il y a du soleil": "It's sunny", "je suis content": "I am happy (boy)",
    "je suis contente": "I am happy (girl)", "je suis triste": "I am sad",
    "je suis fatigu√©": "I am tired (boy)", "je suis fatigue": "I am tired (boy)",
    "je suis fatigu√©e": "I am tired (girl)", "je suis fatiguee": "I am tired (girl)",
    "je suis malade": "I am sick", "j'ai faim": "I'm hungry", "j'ai soif": "I'm thirsty"
};

let cache = {}, cur = null, sp = null;
let deferredPrompt = null;
let isTranslatingAll = false;

// ========== SPEECH SYNTHESIS SMART INITIALIZATION ==========
let speechInitialized = false;

function initializeSpeechSynthesis() {
    if (!('speechSynthesis' in window) || speechInitialized) return;
    
    try {
        const voices = speechSynthesis.getVoices();
        
        // Create minimal utterance
        const utterance = new SpeechSynthesisUtterance('.');
        utterance.volume = 0.05;
        utterance.rate = 1.0;
        
        // Use French voice if available
        const frenchVoice = voices.find(v => v.lang.startsWith('fr'));
        if (frenchVoice) {
            utterance.voice = frenchVoice;
            utterance.lang = 'fr-FR';
        }
        
        // Speak and cancel quickly
        speechSynthesis.speak(utterance);
        setTimeout(() => {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
        }, 20);
        
        speechInitialized = true;
        console.log('üé§ Speech synthesis initialized');
        
        // Update UI if needed
        const prompt = document.getElementById('speechInitPrompt');
        if (prompt) {
            prompt.style.display = 'none';
            // Show success message
            const successMsg = document.createElement('div');
            successMsg.className = 'status-bar';
            successMsg.style.cssText = 'background: #E8F5E9; color: #06D6A0; margin-top: 10px;';
            successMsg.innerHTML = 'üéâ Voice ready! Try speaking now!';
            prompt.parentNode.insertBefore(successMsg, prompt.nextSibling);
            setTimeout(() => successMsg.style.display = 'none', 2000);
        }
        
    } catch (e) {
        console.log('Speech initialization failed:', e);
    }
}

// Setup initialization triggers
function setupSpeechInitialization() {
    // Method 1: Initialize on first click anywhere
    document.addEventListener('click', function initOnFirstClick() {
        if (!speechInitialized) {
            initializeSpeechSynthesis();
        }
        document.removeEventListener('click', initOnFirstClick);
    }, { once: true });
    
    // Method 2: Initialize on hover over speak buttons
    setTimeout(() => {
        const speakButtons = document.querySelectorAll('.speak-btn, .translate-btn');
        speakButtons.forEach(btn => {
            btn.addEventListener('mouseenter', () => {
                if (!speechInitialized) {
                    initializeSpeechSynthesis();
                }
            }, { once: true });
            
            btn.addEventListener('touchstart', () => {
                if (!speechInitialized) {
                    initializeSpeechSynthesis();
                }
            }, { once: true, passive: true });
        });
    }, 500);
    
    // Method 3: Show fun prompt after 3 seconds if not initialized
    setTimeout(() => {
        if (!speechInitialized) {
            const statusBar = document.getElementById('statusBar');
            if (statusBar && !document.getElementById('speechInitPrompt')) {
                const prompt = document.createElement('div');
                prompt.id = 'speechInitPrompt';
                prompt.className = 'status-bar speech-prompt';
                prompt.innerHTML = '<span>üé§‚ú®</span><span>Tap here to make voices super fast!</span>';
                prompt.onclick = initializeSpeechSynthesis;
                statusBar.insertAdjacentElement('afterend', prompt);
                
                // Auto-hide after 20 seconds
                setTimeout(() => {
                    if (prompt.parentNode && !speechInitialized) {
                        prompt.style.opacity = '0';
                        prompt.style.transform = 'translateY(-10px)';
                        setTimeout(() => {
                            if (prompt.parentNode) prompt.style.display = 'none';
                        }, 300);
                    }
                }, 20000);
            }
        }
    }, 3000);
}

// ========== SERVICE WORKER ==========
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        const swScript = `
            const CACHE_NAME = 'french-fun-helper-v1';
            self.addEventListener('install', event => self.skipWaiting());
            self.addEventListener('activate', event => event.waitUntil(clients.claim()));
            self.addEventListener('fetch', event => event.respondWith(caches.match(event.request).then(response => response || fetch(event.request))));
        `;
        const blob = new Blob([swScript], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        navigator.serviceWorker.register(swUrl).catch(console.error);
    });
}

// ========== SHARE FUNCTIONALITY ==========
function openShareModal() {
    shareModal.style.display = 'flex';
    // Reset displays
    shareUrlDisplay.style.display = 'none';
    qrCodeDisplay.style.display = 'none';
}

function closeShareModal() {
    shareModal.style.display = 'none';
}

// Get current URL (for sharing)
function getAppURL() {
    return window.location.href;
}

// Copy URL to clipboard
function shareViaURL() {
    const url = getAppURL();
    currentUrlElement.textContent = url;
    shareUrlDisplay.style.display = 'block';
    qrCodeDisplay.style.display = 'none';
}

function copyURL() {
    const url = getAppURL();
    navigator.clipboard.writeText(url).then(() => {
        alert('üéâ‚úÖ Link copied! Share this fun app with friends:\n\n' + url);
    }).catch(err => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = url;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('üéâ‚úÖ Link copied!');
    });
}

// Generate QR Code
function shareViaQR() {
    const url = getAppURL();
    shareUrlDisplay.style.display = 'none';
    qrCodeDisplay.style.display = 'block';
    
    // Clear previous QR code
    qrCodeDisplay.innerHTML = '';
    
    // Generate QR code using Google Charts API
    const qrSize = 200;
    const qrUrl = `https://chart.googleapis.com/chart?cht=qr&chs=${qrSize}x${qrSize}&chl=${encodeURIComponent(url)}&choe=UTF-8`;
    
    const qrImg = document.createElement('img');
    qrImg.src = qrUrl;
    qrImg.alt = 'QR Code for French Fun Helper';
    qrImg.style.width = '100%';
    qrImg.style.height = 'auto';
    qrImg.style.borderRadius = '15px';
    qrImg.style.border = '5px solid #FFD166';
    qrCodeDisplay.appendChild(qrImg);
    
    // Add download button
    const downloadBtn = document.createElement('button');
    downloadBtn.innerHTML = 'üì• Download QR Code';
    downloadBtn.style.marginTop = '15px';
    downloadBtn.style.padding = '12px 20px';
    downloadBtn.style.background = 'linear-gradient(135deg, #06D6A0 0%, #0CB48A 100%)';
    downloadBtn.style.color = 'white';
    downloadBtn.style.border = 'none';
    downloadBtn.style.borderRadius = '12px';
    downloadBtn.style.cursor = 'pointer';
    downloadBtn.style.fontWeight = '900';
    downloadBtn.style.fontFamily = "'Comic Neue', cursive";
    downloadBtn.onclick = () => downloadQRCode(qrUrl);
    qrCodeDisplay.appendChild(downloadBtn);
}

function downloadQRCode(qrUrl) {
    const link = document.createElement('a');
    link.href = qrUrl;
    link.download = 'french-fun-helper-qr.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    alert('üéâ QR Code downloaded! Share it with friends!');
}

// Share via WhatsApp
function shareViaWhatsApp() {
    const url = getAppURL();
    const text = `üéâ Check out French Fun Helper! A super fun way to learn French with games and sounds! Perfect for kids! ${url}`;
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(whatsappUrl, '_blank');
}

// Share via Email
function shareViaEmail() {
    const url = getAppURL();
    const subject = 'üéâ French Fun Helper - Super Fun French Learning for Kids!';
    const body = `Hi there! üëã

I found this AMAZING French learning app that kids LOVE:

üåà French Fun Helper
${url}

üéØ What makes it awesome:
‚Ä¢ üéÆ Fun games and colorful buttons
‚Ä¢ üé§ French and English pronunciation
‚Ä¢ üìö Works even without internet
‚Ä¢ üì± Can be installed like an app
‚Ä¢ üéâ Perfect for school and home practice

Kids can practice French phrases, colors, numbers, animals, and more!

Perfect for students learning French - they'll have so much fun they won't even realize they're learning! üòä

Best wishes,
A happy user`;
    
    const mailtoUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = mailtoUrl;
}

// Use Web Share API if available (mobile devices)
function checkWebShareAPI() {
    if (navigator.share) {
        const shareButton = document.getElementById('shareButton');
        shareButton.onclick = async () => {
            try {
                await navigator.share({
                    title: 'üéâ French Fun Helper',
                    text: 'A super fun way to learn French! Perfect for kids with games, sounds, and colorful buttons!',
                    url: window.location.href,
                });
                console.log('üéâ Shared successfully');
            } catch (err) {
                // User cancelled or error, fallback to modal
                openShareModal();
            }
        };
    }
}

// Check for Web Share API on load
document.addEventListener('DOMContentLoaded', checkWebShareAPI);

// ========== PWA INSTALL PROMPT ==========
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installButton.style.display = 'flex';
    
    installButton.onclick = () => {
        installButton.style.display = 'none';
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
            deferredPrompt = null;
        });
    };
});

window.addEventListener('appinstalled', () => {
    installButton.style.display = 'none';
    deferredPrompt = null;
    // Show celebration
    const celebration = document.createElement('div');
    celebration.className = 'status-bar';
    celebration.style.cssText = 'background: linear-gradient(135deg, #FFD166 0%, #FFB347 100%); color: white; margin-top: 10px; animation: bounce 0.5s infinite alternate;';
    celebration.innerHTML = 'üéâ App installed! Fun times ahead! üéà';
    sb.insertAdjacentElement('afterend', celebration);
    setTimeout(() => celebration.style.display = 'none', 3000);
});

// ========== CORE FUNCTIONS ==========
function norm(t) {
    return t.toLowerCase().trim().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
}

function getTr(t) {
    const n = norm(t);
    return dict[n] || cache[n] || null;
}

function saveTr(f, e) {
    cache[norm(f)] = e;
    try {
        localStorage.setItem('phraseTranslations', JSON.stringify(cache));
    } catch (err) {
        console.warn('Failed to save translation:', err);
    }
    updSt();
}

async function fetchTr(t) {
    if (!navigator.onLine) return null;
    
    // Try LibreTranslate
    try {
        const r = await fetch('https://libretranslate.com/translate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ q: t, source: 'fr', target: 'en', format: 'text' })
        });
        if (r.ok) {
            const d = await r.json();
            return d.translatedText;
        }
    } catch (e) {
        console.log('LibreTranslate failed:', e);
    }
    
    // Try MyMemory as fallback
    try {
        const r = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(t)}&langpair=fr|en`);
        const d = await r.json();
        if (d.responseData?.translatedText) return d.responseData.translatedText;
    } catch (e) {
        console.log('MyMemory failed:', e);
    }
    
    return null;
}

// ========== BULK TRANSLATION FUNCTION ==========
async function translateAllPhrases() {
    if (!navigator.onLine) {
        alert('üì° Oops! You need to be online to translate phrases. Connect to the internet and try again!');
        return;
    }
    
    if (isTranslatingAll) return;
    
    const cards = document.querySelectorAll('.phrase-card');
    if (cards.length === 0) {
        alert('üìù Add some phrases first! Type them in or choose a fun set above!');
        return;
    }
    
    // Count phrases that need translation
    let phrasesToTranslate = [];
    cards.forEach(card => {
        const french = card.dataset.french;
        if (!getTr(french)) {
            phrasesToTranslate.push({
                card: card,
                french: french,
                englishText: card.querySelector('.english-text'),
                badge: card.querySelector('.confidence-badge')
            });
        }
    });
    
    if (phrasesToTranslate.length === 0) {
        alert('üéâ Awesome! All phrases already have translations! You\'re ready to practice!');
        return;
    }
    
    // Ask for confirmation with fun emoji
    if (!confirm(`üéØ Translate ${phrasesToTranslate.length} phrase(s)? This will be super fun! ‚ú®`)) {
        return;
    }
    
    isTranslatingAll = true;
    translateAllBtn.disabled = true;
    translateAllBtn.innerHTML = '<span>‚è≥‚ú®</span> Magic translating...';
    
    // Show progress bar
    progressBar.style.display = 'block';
    progressText.style.display = 'block';
    progressFill.style.width = '0%';
    progressText.textContent = '‚ú® Getting ready...';
    
    let translatedCount = 0;
    let savedCount = 0;
    
    // Process each phrase with delay to avoid API rate limiting
    for (let i = 0; i < phrasesToTranslate.length; i++) {
        const item = phrasesToTranslate[i];
        
        // Update progress
        const progress = Math.round(((i + 1) / phrasesToTranslate.length) * 100);
        progressFill.style.width = `${progress}%`;
        progressText.textContent = `üéØ Translating... ${i + 1} of ${phrasesToTranslate.length} (${progress}%)`;
        
        // Show which phrase is being translated
        item.card.style.boxShadow = '0 0 0 3px #118AB2';
        item.englishText.textContent = '‚ú® Translating...';
        item.englishText.style.color = '#118AB2';
        item.englishText.style.fontWeight = '900';
        
        try {
            const translation = await fetchTr(item.french);
            
            if (translation) {
                // Save translation
                saveTr(item.french, translation);
                translatedCount++;
                savedCount++;
                
                // Update UI with fun effects
                item.englishText.textContent = translation;
                item.englishText.style.color = '#06D6A0';
                item.card.classList.add('has-translation');
                item.badge.textContent = '‚úÖ Ready!';
                item.badge.style.background = 'linear-gradient(135deg, #E8F5E9 0%, #D4EDDA 100%)';
                item.badge.style.color = '#06D6A0';
                item.badge.style.borderColor = '#06D6A0';
                item.badge.style.transform = 'scale(1.2)';
                
                // Flash effect for saved badge
                setTimeout(() => {
                    item.badge.style.transform = 'scale(1)';
                    item.badge.textContent = 'üéâ Ready!';
                    item.card.style.boxShadow = '';
                }, 500);
            } else {
                item.englishText.textContent = 'ü§î Try again!';
                item.englishText.style.color = '#EF476F';
                translatedCount++;
            }
        } catch (error) {
            item.englishText.textContent = 'üòÖ Oops!';
            item.englishText.style.color = '#EF476F';
            console.error('Translation error:', error);
        }
        
        // Small delay between requests to avoid rate limiting
        if (i < phrasesToTranslate.length - 1) {
            await new Promise(resolve => setTimeout(resolve, 300));
        }
    }
    
    // Hide progress bar
    setTimeout(() => {
        progressBar.style.display = 'none';
        progressText.style.display = 'none';
    }, 1000);
    
    // Update button
    translateAllBtn.disabled = false;
    translateAllBtn.innerHTML = '<span>üåê‚ú®</span>Translate Everything!';
    isTranslatingAll = false;
    
    // Show fun results
    alert(`üéâ Hooray! Translation complete!\n\n‚úÖ Successfully translated: ${savedCount} phrase(s)\nüéØ Ready for practice: ${savedCount} phrase(s)\n\nAll translations saved for offline fun! üèÜ`);
    
    // Update status
    updSt();
}

// ========== UI FUNCTIONS ==========
document.addEventListener('DOMContentLoaded', () => {
    // Load cached translations
    const s = localStorage.getItem('phraseTranslations');
    if (s) {
        try {
            cache = JSON.parse(s);
        } catch (e) {
            console.warn('Failed to parse cached translations:', e);
        }
    }
    
    // Load saved phrases
    const p = localStorage.getItem('frenchPhrases');
    if (p) {
        inp.value = p;
        updList();
    }
    
    updSt();
    setupSpeechInitialization();
    
    // Add input listener for real-time updates
    inp.addEventListener('input', updList);
    
    // Add fun typing sound effect placeholder
    inp.addEventListener('focus', () => {
        inp.style.background = '#FFF9C4';
    });
    inp.addEventListener('blur', () => {
        inp.style.background = '#FFF9E6';
    });
});

function updSt() {
    const c = Object.keys(cache).length;
    const d = Object.keys(dict).length;
    const t = c + d;
    
    const isOnline = navigator.onLine;
    if (isOnline) {
        sb.className = 'status-bar';
        statusIcon.textContent = 'üåê';
        statusText.textContent = `üéâ Online ‚Ä¢ ${t} fun phrases ready!`;
        document.querySelectorAll('.translate-btn').forEach(btn => {
            btn.disabled = false;
            btn.title = "";
        });
    } else {
        sb.className = 'status-bar offline';
        statusIcon.textContent = 'üì¥';
        statusText.textContent = `üè† Offline ‚Ä¢ ${t} phrases for practice!`;
        document.querySelectorAll('.translate-btn').forEach(btn => {
            btn.disabled = true;
            btn.title = "Need internet for new translations";
        });
        translateAllBtn.disabled = true;
    }
}

window.addEventListener('online', updSt);
window.addEventListener('offline', updSt);

function loadPreset(e, n) {
    cur = n;
    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
    e.currentTarget.classList.add('active');
    // Add fun click effect
    e.currentTarget.style.transform = 'scale(0.95)';
    setTimeout(() => {
        e.currentTarget.style.transform = '';
    }, 200);
    disp(sets[n]);
}

function savePhrases() {
    const t = inp.value.trim();
    if (!t) {
        alert('üìù Add some fun phrases first! Ask your teacher or choose a set above!');
        return;
    }
    try {
        localStorage.setItem('frenchPhrases', t);
        cur = null;
        document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
        updList();
        alert('üéâ Your work is saved! Great job! üèÜ');
    } catch (err) {
        alert('üòÖ Oops! Storage is full. Try clearing some space.');
    }
}

function clearPhrases() {
    if (confirm('üßπ Clear all phrases? Don\'t worry, your saved work is safe!')) {
        inp.value = '';
        cur = null;
        document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
        updList();
    }
}

function updList() {
    const t = inp.value;
    const p = t.split('\n').map(l => l.trim()).filter(l => l.length > 0);
    disp(p);
}

function disp(ps) {
    lst.innerHTML = '';
    if (ps.length === 0) {
        lst.innerHTML = `
            <div class="empty-state">
                <p style="font-size: 24px; margin-bottom: 20px;">üéÆ Let's Play French!</p>
                <p>üëÜ Choose a fun set above</p>
                <p>üìù Or type phrases from your teacher!</p>
                <p style="margin-top: 20px; color: #FF6B8B; font-weight: 900;">üéØ Ready to learn? Let's go! üöÄ</p>
            </div>
        `;
        return;
    }
    
    ps.forEach((p, i) => {
        const tr = getTr(p);
        const c = document.createElement('div');
        c.className = 'phrase-card';
        c.dataset.index = i;
        c.dataset.french = p;
        if (tr) c.classList.add('has-translation');
        
        const b = document.createElement('div');
        b.className = 'confidence-badge';
        b.textContent = tr ? 'üéâ Ready!' : '';
        
        const f = document.createElement('div');
        f.className = 'french-text';
        f.textContent = p;
        
        const e = document.createElement('div');
        e.className = 'english-text';
        e.textContent = tr || (navigator.onLine ? 'üéØ Tap orange for translation!' : 'üè† Offline - saved phrases only');
        
        const bs = document.createElement('div');
        bs.className = 'buttons-row';
        
        const sb = document.createElement('button');
        sb.className = 'speak-btn';
        sb.innerHTML = '<span>üé§</span> French Voice';
        sb.onclick = () => spkFr(i);
        sb.disabled = !('speechSynthesis' in window);
        if (!('speechSynthesis' in window)) {
            sb.title = "Voice not supported in this browser";
        }
        
        const tb = document.createElement('button');
        tb.className = 'translate-btn';
        tb.innerHTML = '<span>üéØ</span> English Voice';
        tb.onclick = () => trSpk(i);
        tb.disabled = !navigator.onLine;
        if (!navigator.onLine) {
            tb.title = "Need internet for translation";
        }
        
        const ind = document.createElement('div');
        ind.className = 'speaking-indicator';
        ind.innerHTML = '<div class="pulse-dot"></div><span>üé§ Speaking...</span>';
        
        bs.appendChild(sb);
        bs.appendChild(tb);
        c.appendChild(b);
        c.appendChild(f);
        c.appendChild(e);
        c.appendChild(bs);
        c.appendChild(ind);
        lst.appendChild(c);
    });
}

function spkFr(i) {
    if (!('speechSynthesis' in window)) {
        alert('üé§ Oops! Voice not supported in your browser. Try Chrome or Safari!');
        return;
    }
    
    if (speechSynthesis.speaking) return;
    
    const c = document.querySelector(`.phrase-card[data-index="${i}"]`);
    if (!c) return;
    
    const t = c.querySelector('.french-text').textContent;
    if (sp) speechSynthesis.cancel();
    
    document.querySelectorAll('.phrase-card').forEach(x => x.classList.remove('speaking'));
    c.classList.add('speaking');
    
    const u = new SpeechSynthesisUtterance(t);
    u.lang = 'fr-FR';
    u.rate = 0.85;
    
    // Try to find French voice for better pronunciation
    const voices = speechSynthesis.getVoices();
    const frenchVoice = voices.find(v => v.lang.startsWith('fr'));
    if (frenchVoice) {
        u.voice = frenchVoice;
    }
    
    u.onend = u.onerror = () => {
        c.classList.remove('speaking');
        sp = null;
    };
    sp = u;
    speechSynthesis.speak(u);
}

async function trSpk(i) {
    const c = document.querySelector(`.phrase-card[data-index="${i}"]`);
    if (!c) return;
    
    const f = c.dataset.french;
    const el = c.querySelector('.english-text');
    const btn = c.querySelector('.translate-btn');
    let tr = getTr(f);
    
    if (!tr) {
        if (!navigator.onLine) {
            el.textContent = 'üè† Offline - try when connected!';
            el.style.color = '#FF8E53';
            return;
        }
        
        btn.classList.add('translating');
        btn.innerHTML = '<span>‚è≥‚ú®</span> Magic translating...';
        btn.disabled = true;
        
        tr = await fetchTr(f);
        if (tr) {
            saveTr(f, tr);
            el.textContent = tr;
            el.style.color = '#06D6A0';
            c.classList.add('has-translation');
            const badge = c.querySelector('.confidence-badge');
            badge.textContent = '‚úÖ Saved!';
            badge.style.background = 'linear-gradient(135deg, #E1BEE7 0%, #D1C4E9 100%)';
            badge.style.color = '#9D4EDD';
            badge.style.borderColor = '#9D4EDD';
            
            setTimeout(() => {
                badge.textContent = 'üéâ Ready!';
                badge.style.background = 'linear-gradient(135deg, #E8F5E9 0%, #D4EDDA 100%)';
                badge.style.color = '#06D6A0';
                badge.style.borderColor = '#06D6A0';
            }, 1000);
        } else {
            el.textContent = 'ü§î Try again!';
            el.style.color = '#EF476F';
        }
        
        btn.classList.remove('translating');
        btn.innerHTML = '<span>üéØ</span> English Voice';
        btn.disabled = false;
    }
    
    if (tr) spkEn(c, tr);
}

function spkEn(c, t) {
    if (!('speechSynthesis' in window)) {
        alert('üé§ Oops! Voice not supported in your browser. Try Chrome or Safari!');
        return;
    }
    
    if (speechSynthesis.speaking) return;
    if (sp) speechSynthesis.cancel();
    
    document.querySelectorAll('.phrase-card').forEach(x => x.classList.remove('speaking'));
    c.classList.add('speaking');
    
    const u = new SpeechSynthesisUtterance(t);
    u.lang = 'en-US';
    u.rate = 0.9;
    u.onend = u.onerror = () => {
        c.classList.remove('speaking');
        sp = null;
    };
    sp = u;
    speechSynthesis.speak(u);
}

// Clean up speech synthesis on page unload
window.addEventListener('beforeunload', () => {
    if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
    }
});
    </script>
</body>
</html>